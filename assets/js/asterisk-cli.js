//Because I press enter by habit
$("#astcmd").keyup(function(event){
    if(event.keyCode == 13){
        $("#send").click();
    }
});

$('#send').click(function(){
	var dat = $('#astcmd').val();
  $('div.output').html("<pre>"+ _("Loading...") +"</pre>");
	$.get("ajax.php?module=asterisk-cli&command=clicmd&data=" + dat,function(data,status){
		if(data.status) {
			var reply = JSON.parse(data.message);
			$('div.output').html("<pre>"+ reply +"</pre>");
		}else{
			$('div.output').html("<b>Error</b>");
		}
	});
});

  var cliCommands = [
  "acl show",
  "ael reload",
  "ael set debug read",
  "ael set debug tokens",
  "ael set debug macros",
  "ael set debug contexts",
  "ael set debug off",
  "agi dump html",
  "agi exec",
  "agi set debug on",
  "agi set debug off",
  "aoc set debug",
  "ari mkpasswd",
  "ari show status",
  "ari show users",
  "ari show user",
  "bridge kick",
  "bridge show all",
  "bridge show",
  "bridge technology show",
  "bridge technology unsuspend",
  "bridge technology suspend",
  "cc cancel",
  "cc report status",
  "cdr set debug off",
  "cdr set debug on",
  "cdr show active",
  "cdr show status",
  "cdr submit",
  "cel show status",
  "channel originate",
  "channel redirect",
  "channel request hangup",
  "cli check permissions",
  "cli reload permissions",
  "cli show permissions",
  "confbridge kick",
  "confbridge list",
  "confbridge lock",
  "confbridge mute",
  "confbridge record start",
  "confbridge record stop",
  "confbridge show menu",
  "confbridge show menus",
  "confbridge show profile bridge",
  "confbridge show profile bridges",
  "confbridge show profile user",
  "confbridge show profile users",
  "confbridge unlock",
  "confbridge unmute",
  "config list",
  "config reload",
  "config show help",
  "core abort shutdown",
  "core clear profile",
  "core ping taskprocessor",
  "core reload",
  "core restart gracefully",
  "core restart now",
  "core restart when convenient",
  "core set debug channel",
  "core set debug",
  "core set verbose",
  "core show applications like",
  "core show applications describing",
  "core show application",
  "core show calls",
  "core show calls uptime",
  "core show channels",
  "core show channels concise",
  "core show channels verbose",
  "core show channels count",
  "core show channel",
  "core show channeltypes",
  "core show channeltype",
  "core show codecs",
  "core show codecs audio",
  "core show codecs video",
  "core show codecs image",
  "core show codecs text",
  "core show codec",
  "core show config mappings",
  "core show file formats",
  "core show file version",
  "core show file version like",
  "core show functions",
  "core show functions like",
  "core show function",
  "core show hanguphandlers all",
  "core show hanguphandlers",
  "core show help",
  "core show hints",
  "core show hint",
  "core show image formats",
  "core show license",
  "core show profile",
  "core show settings",
  "core show sounds",
  "core show sound",
  "core show switches",
  "core show sysinfo",
  "core show taskprocessors",
  "core show threads",
  "core show translation",
  "core show uptime",
  "core show uptime seconds",
  "core show version",
  "core show warranty",
  "core stop gracefully",
  "core stop now",
  "core stop when convenient",
  "core waitfullybooted",
  "dahdi create channels",
  "dahdi destroy channels",
  "dahdi restart",
  "dahdi set dnd",
  "dahdi set hwgain rx",
  "dahdi set hwgain tx",
  "dahdi set swgain rx",
  "dahdi set swgain tx",
  "dahdi show cadences",
  "dahdi show channels",
  "dahdi show channel",
  "dahdi show status",
  "dahdi show version",
  "data get",
  "data show providers",
  "database del",
  "database deltree",
  "database get",
  "database put",
  "database query",
  "database show",
  "database showkey",
  "devstate change",
  "devstate list",
  "dialplan add extension",
  "dialplan add ignorepat",
  "dialplan add include",
  "dialplan debug",
  "dialplan reload",
  "dialplan remove context",
  "dialplan remove extension",
  "dialplan remove ignorepat",
  "dialplan remove include",
  "dialplan save",
  "dialplan set chanvar",
  "dialplan set extenpatternmatchnew false",
  "dialplan set extenpatternmatchnew true",
  "dialplan set global",
  "dialplan show",
  "dialplan show chanvar",
  "dialplan show globals",
  "dnsmgr refresh",
  "dnsmgr reload",
  "dnsmgr status",
  "fax set debug off",
  "fax set debug on",
  "fax show capabilities",
  "fax show session",
  "fax show sessions",
  "fax show settings",
  "fax show stats",
  "fax show version",
  "features show",
  "file convert",
  "group show channels",
  "http show status",
  "iax2 provision",
  "iax2 prune realtime",
  "iax2 reload",
  "iax2 set debug on",
  "iax2 set debug off",
  "iax2 set debug peer",
  "iax2 set debug jb on",
  "iax2 set debug jb off",
  "iax2 set debug trunk off}",
  "iax2 set debug trunk on",
  "iax2 set mtu",
  "iax2 show cache",
  "iax2 show callnumber usage",
  "iax2 show channels",
  "iax2 show firmware",
  "iax2 show netstats",
  "iax2 show peer",
  "iax2 show peers",
  "iax2 show provisioning",
  "iax2 show registry",
  "iax2 show stats",
  "iax2 show threads",
  "iax2 show users",
  "iax2 show users like",
  "iax2 test losspct",
  "iax2 unregister",
  "indication add",
  "indication remove",
  "indication show",
  "keys init",
  "keys show",
  "local show channels",
  "logger add channel",
  "logger mute",
  "logger reload",
  "logger remove channel",
  "logger rotate",
  "logger set level",
  "logger show channels",
  "manager reload",
  "manager set debug",
  "manager show command",
  "manager show commands",
  "manager show connected",
  "manager show eventq",
  "manager show events",
  "manager show event",
  "manager show settings",
  "manager show users",
  "manager show user",
  "meetme kick",
  "meetme list",
  "meetme",
  "meetme",
  "mfcr2 call files",
  "mfcr2 set blocked",
  "mfcr2 set debug",
  "mfcr2 set idle",
  "mfcr2 show channels",
  "mfcr2 show variants",
  "mfcr2 show version",
  "mixmonitor",
  "module load",
  "module reload",
  "module show",
  "module unload",
  "moh reload",
  "moh show classes",
  "moh show files",
  "no debug channel",
  "odbc show",
  "parking show",
  "pjproject show buildopts",
  "pjproject show log mappings",
  "pjsip dump endpt",
  "pjsip export config_wizard primitives",
  "pjsip list aors",
  "pjsip list auths",
  "pjsip list channels",
  "pjsip list ciphers",
  "pjsip list contacts",
  "pjsip list endpoints",
  "pjsip list identifies",
  "pjsip list registrations",
  "pjsip list transports",
  "pjsip qualify",
  "pjsip send notify",
  "pjsip send register",
  "pjsip send unregister",
  "pjsip set history",
  "pjsip set logger",
  "pjsip show aors",
  "pjsip show aor",
  "pjsip show auths",
  "pjsip show auth",
  "pjsip show channels",
  "pjsip show channel",
  "pjsip show channelstats",
  "pjsip show contacts",
  "pjsip show contact",
  "pjsip show endpoints",
  "pjsip show endpoint",
  "pjsip show history",
  "pjsip show identifiers",
  "pjsip show identifies",
  "pjsip show identify",
  "pjsip show registrations",
  "pjsip show registration",
  "pjsip show scheduled_tasks",
  "pjsip show settings",
  "pjsip show transports",
  "pjsip show transport",
  "pjsip show unidentified_requests",
  "pjsip show version",
  "presencestate change",
  "presencestate list",
  "pri destroy span",
  "pri service disable channel",
  "pri service enable channel",
  "pri set debug",
  "pri set debug file",
  "pri show channels",
  "pri show debug",
  "pri show spans",
  "pri show span",
  "pri show version",
  "queue add member",
  "queue reload",
  "queue remove member",
  "queue reset stats",
  "queue set penalty",
  "queue set ringinuse",
  "queue show",
  "queue show rules",
  "queue pause member",
  "queue unpause member",
  "realtime destroy",
  "realtime load",
  "realtime mysql cache",
  "realtime mysql status",
  "realtime store",
  "realtime update",
  "realtime update2",
  "rtcp set debug",
  "rtcp set stats",
  "rtp set debug",
  "say load",
  "sip notify",
  "sip prune realtime",
  "sip qualify peer",
  "sip reload",
  "sip set debug",
  "sip set history",
  "sip show channels",
  "sip show subscriptions",
  "sip show channelstats",
  "sip show channel",
  "sip show domains",
  "sip show history",
  "sip show inuse",
  "sip show mwi",
  "sip show objects",
  "sip show peers",
  "sip show peer",
  "sip show registry",
  "sip show sched",
  "sip show settings",
  "sip show tcp",
  "sip show users",
  "sip show user",
  "sip unregister",
  "sla show stations",
  "sla show trunks",
  "sorcery memory cache dump",
  "sorcery memory cache expire",
  "sorcery memory cache populate",
  "sorcery memory cache show",
  "sorcery memory cache stale",
  "ss7 mtp3",
  "ss7 reset cic",
  "ss7 reset group",
  "ss7 restart mtp3",
  "ss7 set debug on linkset",
  "ss7 set debug off linkset",
  "ss7 block cic",
  "ss7 unblock cic",
  "ss7 reset linkset",
  "ss7 block linkset",
  "ss7 reset linkset",
  "ss7 unblock group",
  "ss7 block group",
  "ss7 show calls",
  "ss7 show channels",
  "ss7 show cics",
  "ss7 show linkset",
  "ss7 show version",
  "stun set debug",
  "timing test",
  "transcoder show",
  "udptl set debug",
  "udptl show config",
  "ulimit",
  "voicemail reload",
  "voicemail show users",
  "voicemail show zones",
  "xmldoc dump"];
$(document).ready(function(){
  $('#astcmd').typeahead({
    hint: true,
    highlight: true,
    minLength: 1
  },
  {
    name: 'cliCommands',
    source: substringMatcher(cliCommands)
  });
});
//https://twitter.github.io/typeahead.js/examples/
var substringMatcher = function(strs) {
  return function findMatches(q, cb) {
    var matches, substringRegex;

    // an array that will be populated with substring matches
    matches = [];

    // regex used to determine if a string contains the substring `q`
    substrRegex = new RegExp(q, 'i');

    // iterate through the pool of strings and for any string that
    // contains the substring `q`, add it to the `matches` array
    $.each(strs, function(i, str) {
      if (substrRegex.test(str)) {
        matches.push({ value:str });
      }
    });

    cb(matches);
  };
};
